<!-- trigger pages -->
<!--
  ANNOTATIONS for Lease Calculator (pre-refactor)
   Annotated on 2025-10-17 17:31 â€” index.html
 These notes are additive and do not change behavior.

-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Net Effective Rent (NER) calculator for brokers. Sleek, modern UI." />
  <title>Lee & Associates &mdash; Lease Calculator&mdash;Lease Comparison</title>
  <link rel="icon" href="assets/Lee_Logo.png" />

  <!-- Your app styles -->
  <!-- Stylesheet & theme tokens. Loaded early to avoid FOUC. -->
<link rel="stylesheet" href="css/styles.css" />

<!-- MapTiler SDK (CSS + JS) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@maptiler/sdk/dist/maptiler-sdk.css" />
<style>
  /* Lee map theming */
  #map .maplibregl-popup.lee-popup .maplibregl-popup-content,
  #map .mapboxgl-popup.lee-popup .mapboxgl-popup-content {
    background: linear-gradient(180deg, var(--popup-bg-a), var(--popup-bg-b));
    color: #fff;
    border-radius: 12px;
    padding: 12px 14px;
    border: 1px solid var(--popup-border);
    box-shadow: var(--popup-shadow);
    backdrop-filter: blur(4px);
  }

  #map .maplibregl-popup.lee-popup.maplibregl-popup-anchor-top    .maplibregl-popup-tip,
  #map .mapboxgl-popup.lee-popup.mapboxgl-popup-anchor-top        .mapboxgl-popup-tip { border-bottom-color: rgba(8,8,10,.95) !important; }
  #map .maplibregl-popup.lee-popup.maplibregl-popup-anchor-bottom .maplibregl-popup-tip,
  #map .mapboxgl-popup.lee-popup.mapboxgl-popup-anchor-bottom     .mapboxgl-popup-tip { border-top-color:    rgba(8,8,10,.95) !important; }
  #map .maplibregl-popup.lee-popup.maplibregl-popup-anchor-left   .maplibregl-popup-tip,
  #map .mapboxgl-popup.lee-popup.mapboxgl-popup-anchor-left       .mapboxgl-popup-tip { border-right-color:  rgba(8,8,10,.95) !important; }
  #map .maplibregl-popup.lee-popup.maplibregl-popup-anchor-right  .maplibregl-popup-tip,
  #map .mapboxgl-popup.lee-popup.mapboxgl-popup-anchor-right      .mapboxgl-popup-tip { border-left-color:   rgba(8,8,10,.95) !important; }

  #map .lee-popup .map-card-title {
    color: #fff;
    font-weight: 700;
    margin-bottom: 4px;
  }

  #map .lee-popup .map-card-body {
    color: #fff;
    opacity: .95;
  }

  #map .lee-popup .maplibregl-popup-content a,
  #map .lee-popup .mapboxgl-popup-content a {
    color: #9bd3ff;
    text-decoration: underline;
  }

  .lee-pin {
    width: 50px;
    height: 50px;
    display: block;
    pointer-events: none;
    user-select: none;
    filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/@maptiler/sdk/dist/maptiler-sdk.umd.min.js" defer></script>
</head>

<body>
  <a class="skip" href="#main">Skip to content</a>
  <header class="site-header">
    <div class="brand">
      <img src="assets/Lee_Logo.png" alt="Lee & Associates logo" class="logo" />
      <div class="brand-text">
        <span class="brand-top">Lee & Associates</span>
        <span class="brand-bottom">Broker Tools</span>
      </div>
    </div>
    <nav class="nav">
      <a href="#" class="nav-link active">Lease Calculator w/Lease Comparison</a>
      <a href="#" class="nav-link disabled" aria-disabled="true" title="Coming soon">Lease vs Buy Calculator</a>
      <a href="#" class="nav-link disabled" aria-disabled="true" title="Coming soon">Acquisition Calculator</a>
      <a href="#" class="nav-link disabled" aria-disabled="true" title="Coming soon">Market Analytics</a>
    </nav>
  </header>

<main id="main" class="container one-col widescreen">
  <section class="panel panel-inputs">
    <img
  class="panel-logo"
  src="assets/Lee_Logo.png"
  alt="Lee & Associates"
  />
    <h1 class="panel-title">Lease Calculator w/Lease Comparison</h1>
    <p class="panel-subtitle">Enter deal terms and get instant results.</p>

    <!-- Main inputs in a 4-col grid. js/app.js reads these to build the schedule model. -->
<form id="ner-form" class="grid-4" novalidate>
      <div class="field span-all">
        <label for="suite">Property Address</label>
        <input id="suite" type="text" placeholder="123 Main St, Chicago, IL" autocomplete="off" />
      </div>

      <!-- Property Photo -->
    <div class="field col-span-4" id="photoBlock">
      <label>Property Photo</label>
      <div class="photo-row">
        <input id="propertyPhoto" type="file" accept="image/*" />
        <button type="button" id="clearPhoto" class="btn ghost small">Remove</button>
      </div>
      <div class="photo-preview" id="propertyPreviewWrap" aria-hidden="true" style="display:none">
        <img id="propertyPreview" alt="Property photo preview" />
      </div>
    </div>

      <!-- Map -->
      <div class="field span-all">
        <label class="right" style="visibility:hidden">Map</label>
        <div id="map" class="map"></div>
        <small class="hint">Map centers automatically from the Property Address.</small>
      </div>

<!-- Section: Deal basics -->
<div class="section-head col-span-4" id="sec-deal">
  <h3 class="section-title">Deal Basics</h3>
  <p class="section-sub">Dates, size, term, and rent</p>
</div>

  <!-- Row 1: Commencement spans cols 1â€“2; Space Size in col 3; Lease Term in col 4 -->
  <div class="field col-1-2">
    <label for="commencement">Commencement Date</label>
    <input id="commencement" type="date" />
  </div>

  <div class="field col-3">
    <label for="area">Space Size</label>
    <div class="input-with-addon">
      <input id="area" type="text" inputmode="numeric" placeholder="75,000" data-format="int" />
      <span class="addon">SF</span>
    </div>
  </div>

  <div class="field col-4">
    <label for="term">Lease Term</label>
    <div class="input-with-addon">
      <input id="term" type="number" min="1" step="1" placeholder="60" required />
      <select id="termUnit" aria-label="Lease term unit" class="select-filled">
        <option value="months" selected>Months</option>
        <option value="years">Years</option>
      </select>
    </div>
  </div>  

<!-- Start Base Rent (left half) -->
<div class="field col-1-2">
  <label for="startBase">Start Base Rent</label>
  <div class="input-with-addon">
    <span class="addon">$</span>
    <input id="startBase" type="text" inputmode="decimal" placeholder="10.50" data-format="money" />
    <span class="addon">/SF/yr</span>
  </div>
</div>

<!-- Annual Escalation (right half) -->
<div class="field col-3-4">
  <label for="escalation">Annual Escalation</label>
  <div class="input-with-addon">
    <input id="escalation" type="text" inputmode="decimal" placeholder="3.0" data-format="percent" />
    <select id="escUnit" class="select-filled" aria-label="Escalation type">
      <option value="pct" selected>%/Yr</option>
      <option value="flat">$/SF/Yr</option>
      <option value="custom_pct">Custom (%/Yr)</option>
      <option value="custom">Custom ($/SF/Yr)</option>
    </select>
  </div>

  <div id="escCustomWrap" style="display:none; margin-top:6px;">
    <input id="escCustom" type="text" placeholder="0.50, 0.75, 1.00" aria-label="Custom $/SF bumps by year" />
    <small class="hint">Comma-separated $/SF increases applied at each anniversary (Y2+).</small>
  </div>
</div>

<!-- Services spans the row already -->
<div class="section-head col-span-4" id="sec-services">
  <h3 class="section-title">Services</h3>
  <p class="section-sub">NNN, Modified Gross, or Gross</p>
</div>

<!-- Services (full row) -->
<div class="field col-span-4">
  <label for="serviceType">Services</label>
  <select id="serviceType" class="select-filled">
    <option value="nnn" selected>NNN (Base + Taxes + CAM + Insurance)</option>
    <option value="mg">Modified Gross</option>
    <option value="gross">Gross (Base only)</option>
  </select>
</div>


<!-- =============================== TAXES =============================== -->
<div class="opx" data-kind="taxes">
  <!-- Amount (col 1-2) -->
  <div class="field col-1-2">
    <label id="lblTaxesMain">
      Taxes <span class="kicker" id="lblTaxesKicker" hidden>(Year&nbsp;1 $/SF/yr)</span>
    </label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="taxes" type="text" inputmode="decimal" placeholder="4.00" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint" id="hintTaxesMain">
      Enter the current (Year&nbsp;1) Taxes PSF that will escalate by the rate below.
    </small>
  </div>

  <!-- Growth (col 3-4) + Advanced toggle -->
  <div class="field col-3-4">
    <label class="right">
      Annual Increase
      <button type="button" class="link tiny" data-adv-toggle="taxes">Advanced</button>
    </label>
    <div class="input-with-addon">
      <input id="taxesGrowth" type="text" inputmode="decimal" placeholder="2.5" data-format="percent" aria-label="Taxes growth" />
      <select id="taxesGrowthUnit" class="select-filled">
        <option value="pct" selected>%/yr</option>
        <option value="flat">$ /SF/yr</option>
      </select>
    </div>
  </div>

  <!-- Include -->
  <label class="service-include col-1-2 inline-check" for="incTaxes">
    <input id="incTaxes" type="checkbox" checked />
    <span>Tenant Pays this Expense</span>
  </label>

  <!-- Pass-through mode (shown in Custom or MG flows) -->
  <div class="opx-mode" data-for="taxes" style="display:none;">
    <label class="right">Taxes — Pass-through Mode</label>
    <select id="taxesMode" class="select-filled">
      <option value="tenant" selected>Tenant pays 100%</option>
      <option value="landlord">Landlord pays 100%</option>
      <option value="stop">Base-year stop (increases only)</option>
    </select>
  </div>

  <!-- Base-year override (only when stop) -->
  <div class="opx-base" data-for="taxes" style="display:none;">
    <label class="right" id="lblTaxesBase">Base-year Taxes ($/SF/yr)</label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="taxesBase" type="text" inputmode="decimal" placeholder="leave blank to auto" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint">
      Used only when Pass-through Mode = Base-year stop. Leave blank to auto-fill per your escalation model.
    </small>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="taxes" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="taxesStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="taxesStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="taxesStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <!-- Advanced row (spans all 4 columns) -->
  <div class="opx-adv col-1-4" data-for="taxes" hidden>
    <div class="adv-grid">
      <!-- Gross-up -->
      <div class="adv-group">
        <div class="adv-title">Gross-up</div>
        <label class="inline-check">
          <input id="taxesGrossupOn" type="checkbox" />
          <span>Enable (normalize when actual &lt; target)</span>
        </label>
        <div class="adv-inline">
          <input id="taxesGrossupTarget" class="w-16" placeholder="95" data-format="percent" />
          <span class="muted">target&nbsp;%</span>
          <input id="taxesOccActual" class="w-16" placeholder="(actual)" data-format="percent" />
          <span class="muted">actual&nbsp;%</span>
        </div>
      </div>

      <!-- Cap / Floor -->
      <div class="adv-group">
        <div class="adv-title">Cap / Floor</div>
        <label class="inline-check">
          <input id="taxesCapOn" type="checkbox" />
          <span>Enable bounds on YOY growth</span>
        </label>
        <div class="adv-inline">
          <input id="taxesFloorPct" class="w-16" placeholder="(floor)" data-format="percent" />
          <input id="taxesCapPct"   class="w-16" placeholder="(cap)"   data-format="percent" />
          <select id="taxesCapMode" class="select-filled w-28">
            <option value="comp" selected>Compounded</option>
            <option value="noncum">Non-cumulative</option>
          </select>
        </div>
      </div>

      <!-- Base-year policy (visible only when stop) -->
      <div class="adv-group" data-show-when-stop="true">
        <div class="adv-title">Base-year policy</div>
        <div class="adv-inline">
          <select id="taxesBasePolicy" class="select-filled w-40">
            <option value="firstCY">First calendar year</option>
            <option value="firstFullCY" selected>First full calendar year</option>
            <option value="explicit">Explicit year…</option>
          </select>
          <input id="taxesBaseYear" class="w-20" placeholder="2026" data-format="year" hidden />
        </div>
      </div>
    </div>
  </div>
</div>

<!-- =============================== CAM =============================== -->
<div class="opx" data-kind="cam">
  <!-- Amount (col 1-2) -->
  <div class="field col-1-2">
    <label id="lblCamMain">
      CAM <span class="kicker" id="lblCamKicker" hidden>(Year&nbsp;1 $/SF/yr)</span>
    </label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="cam" type="text" inputmode="decimal" placeholder="3.00" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint" id="hintCamMain">
      Enter the current CAM PSF that will escalate by the rate below.
    </small>
  </div>

  <!-- Growth (col 3-4) + Advanced toggle -->
  <div class="field col-3-4">
    <label class="right">
      Annual Increase
      <button type="button" class="link tiny" data-adv-toggle="cam">Advanced</button>
    </label>
    <div class="input-with-addon">
      <input id="camGrowth" type="text" inputmode="decimal" placeholder="2.5" data-format="percent" aria-label="CAM growth" />
      <select id="camGrowthUnit" class="select-filled">
        <option value="pct" selected>%/yr</option>
        <option value="flat">$ /SF/yr</option>
      </select>
    </div>
  </div>

  <!-- Include -->
  <label class="service-include col-1-2 inline-check" for="incCam">
    <input id="incCam" type="checkbox" checked />
    <span>Tenant Pays this Expense</span>
  </label>

  <!-- Pass-through mode -->
  <div class="opx-mode" data-for="cam" style="display:none;">
    <label class="right">CAM — Pass-through Mode</label>
    <select id="camMode" class="select-filled">
      <option value="tenant" selected>Tenant pays 100%</option>
      <option value="landlord">Landlord pays 100%</option>
      <option value="stop">Base-year stop (increases only)</option>
    </select>
  </div>

  <!-- Base-year override -->
  <div class="opx-base" data-for="cam" style="display:none;">
    <label class="right" id="lblCamBase">Base-year CAM ($/SF/yr)</label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="camBase" type="text" inputmode="decimal" placeholder="leave blank to auto" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint">
      Used only when Pass-through Mode = Base-year stop. Leave blank to auto-fill per your escalation model.
    </small>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <div class="opx-stop" data-for="cam" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="camStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="camStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="camStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

  <!-- Advanced row -->
  <div class="opx-adv col-1-4" data-for="cam" hidden>
    <div class="adv-grid">
      <!-- Gross-up (typical for CAM) -->
      <div class="adv-group">
        <div class="adv-title">Gross-up</div>
        <label class="inline-check">
          <input id="camGrossupOn" type="checkbox" />
          <span>Enable (normalize when actual &lt; target)</span>
        </label>
        <div class="adv-inline">
          <input id="camGrossupTarget" class="w-16" placeholder="95" data-format="percent" />
          <span class="muted">target&nbsp;%</span>
          <input id="camOccActual" class="w-16" placeholder="(actual)" data-format="percent" />
          <span class="muted">actual&nbsp;%</span>
        </div>
      </div>

      <!-- Cap / Floor -->
      <div class="adv-group">
        <div class="adv-title">Cap / Floor</div>
        <label class="inline-check">
          <input id="camCapOn" type="checkbox" />
          <span>Enable bounds on YOY growth</span>
        </label>
        <div class="adv-inline">
          <input id="camFloorPct" class="w-16" placeholder="(floor)" data-format="percent" />
          <input id="camCapPct"   class="w-16" placeholder="(cap)"   data-format="percent" />
          <select id="camCapMode" class="select-filled w-28">
            <option value="comp" selected>Compounded</option>
            <option value="noncum">Non-cumulative</option>
          </select>
        </div>
      </div>

      <!-- Base-year policy -->
      <div class="adv-group" data-show-when-stop="true">
        <div class="adv-title">Base-year policy</div>
        <div class="adv-inline">
          <select id="camBasePolicy" class="select-filled w-40">
            <option value="firstCY">First calendar year</option>
            <option value="firstFullCY" selected>First full calendar year</option>
            <option value="explicit">Explicit year…</option>
          </select>
          <input id="camBaseYear" class="w-20" placeholder="2026" data-format="year" hidden />
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================ INSURANCE ============================ -->
<div class="opx" data-kind="ins">
  <!-- Amount (col 1-2) -->
  <div class="field col-1-2">
    <label id="lblInsMain">
      Insurance <span class="kicker" id="lblInsKicker" hidden>(Year&nbsp;1 $/SF/yr)</span>
    </label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="ins" type="text" inputmode="decimal" placeholder="2.50" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint" id="hintInsMain">
      Enter the current Insurance PSF that will escalate by the rate below.
    </small>
  </div>

  <!-- Growth (col 3-4) + Advanced toggle -->
  <div class="field col-3-4">
    <label class="right">
      Annual Increase
      <button type="button" class="link tiny" data-adv-toggle="ins">Advanced</button>
    </label>
    <div class="input-with-addon">
      <input id="insGrowth" type="text" inputmode="decimal" placeholder="2.0" data-format="percent" aria-label="Insurance growth" />
      <select id="insGrowthUnit" class="select-filled">
        <option value="pct" selected>%/yr</option>
        <option value="flat">$ /SF/yr</option>
      </select>
    </div>
  </div>

  <!-- Include -->
  <label class="service-include col-1-2 inline-check" for="incIns">
    <input id="incIns" type="checkbox" checked />
    <span>Tenant Pays this Expense</span>
  </label>

  <!-- Pass-through mode -->
  <div class="opx-mode" data-for="ins" style="display:none;">
    <label class="right">Insurance — Pass-through Mode</label>
    <select id="insMode" class="select-filled">
      <option value="tenant" selected>Tenant pays 100%</option>
      <option value="landlord">Landlord pays 100%</option>
      <option value="stop">Base-year stop (increases only)</option>
    </select>
  </div>

  <!-- Base-year override -->
  <div class="opx-base" data-for="ins" style="display:none;">
    <label class="right" id="lblInsBase">Base-year Insurance ($/SF/yr)</label>
    <div class="input-with-addon">
      <span class="addon">$</span>
      <input id="insBase" type="text" inputmode="decimal" placeholder="leave blank to auto" data-format="money" />
      <span class="addon">/SF/yr</span>
    </div>
    <small class="hint">
      Used only when Pass-through Mode = Base-year stop. Leave blank to auto-fill per your escalation model.
    </small>
  </div>

  <div class="opx-stop" data-for="ins" style="display:none;">
    <label class="right">Stop Type</label>
    <div class="inline">
      <select id="insStopType" class="select-filled">
        <option value="base" selected>Base-year</option>
        <option value="fixed">Fixed expense stop</option>
      </select>
      <div id="insStopPSFWrap" class="input-with-addon" style="display:none;">
        <span class="addon">$</span>
        <input id="insStopPSF" inputmode="decimal" placeholder="0.00" data-format="money" />
        <span class="addon">/SF/yr</span>
      </div>
    </div>
  </div>

<!-- ========================== Management Fee ========================== -->
<div class="opx opx-row" data-kind="mgmt" id="mgmtRow">
  <div class="field col-1-2">
    <label for="mgmtRate">Management Fee</label>
    <div class="input-with-addon">
      <!-- keep the same id and number input -->
      <input id="mgmtRate" type="number" min="0" step="0.01" inputmode="decimal" placeholder="3.0" />
      <!-- no "of" chip; the select carries the context -->
      <select id="mgmtAppliedOn" class="select-filled" aria-label="Management fee basis">
        <option value="gross" selected>(%) Gross</option>
        <option value="net">(% ) Net</option>
      </select>
    </div>
    <small class="hint">Applied to monthly rent before the fee itself.</small>
  </div>

  <div class="field col-3-4">
    <label for="mgmtMode">Responsibility</label>
    <select id="mgmtMode" class="select-filled">
      <option value="landlord">Landlord pays 100%</option>
      <option value="tenant">Tenant pays 100%</option>
      <option value="stop">Base-year stop (increases only)</option>
    </select>
    <small class="hint">Controls who bears the management fee each period.</small>
  </div>
</div>

<div class="field col-1-2" id="mgmtBaseWrap" style="display:none;">
  <label for="mgmtBase">Management Fee Base-year ($/SF/yr)</label>
  <div class="input-with-addon">
    <span class="addon">$</span>
    <input id="mgmtBase" type="text" inputmode="decimal" data-format="money" placeholder="leave blank to auto" />
    <span class="addon">/SF/yr</span>
  </div>
  <small class="hint">If blank, we’ll auto-set to the first full lease year.</small>
</div>

  <!-- Advanced row -->
  <div class="opx-adv col-1-4" data-for="ins" hidden>
    <div class="adv-grid">
      <!-- Gross-up (optional for insurance) -->
      <div class="adv-group">
        <div class="adv-title">Gross-up</div>
        <label class="inline-check">
          <input id="insGrossupOn" type="checkbox" />
          <span>Enable (normalize when actual &lt; target)</span>
        </label>
        <div class="adv-inline">
          <input id="insGrossupTarget" class="w-16" placeholder="95" data-format="percent" />
          <span class="muted">target&nbsp;%</span>
          <input id="insOccActual" class="w-16" placeholder="(actual)" data-format="percent" />
          <span class="muted">actual&nbsp;%</span>
        </div>
      </div>

      <!-- Cap / Floor -->
      <div class="adv-group">
        <div class="adv-title">Cap / Floor</div>
        <label class="inline-check">
          <input id="insCapOn" type="checkbox" />
          <span>Enable bounds on YOY growth</span>
        </label>
        <div class="adv-inline">
          <input id="insFloorPct" class="w-16" placeholder="(floor)" data-format="percent" />
          <input id="insCapPct"   class="w-16" placeholder="(cap)"   data-format="percent" />
          <select id="insCapMode" class="select-filled w-28">
            <option value="comp" selected>Compounded</option>
            <option value="noncum">Non-cumulative</option>
          </select>
        </div>
      </div>

      <!-- Base-year policy -->
      <div class="adv-group" data-show-when-stop="true">
        <div class="adv-title">Base-year policy</div>
        <div class="adv-inline">
          <select id="insBasePolicy" class="select-filled w-40">
            <option value="firstCY">First calendar year</option>
            <option value="firstFullCY" selected>First full calendar year</option>
            <option value="explicit">Explicit year…</option>
          </select>
          <input id="insBaseYear" class="w-20" placeholder="2026" data-format="year" hidden />
        </div>
      </div>
    </div>
  </div>
</div>


<section id="customExpSection" class="opx-group col-span-4" aria-label="Custom expenses">
  <div class="opx-head">
    <h4>Additional Operating Expenses</h4>
    <button id="addCustomExp" type="button" class="btn small">+ Add expense</button>
  </div>

  <div id="customExpList" class="custom-exp-list"></div>

  <!-- Template for a new expense row -->
  <template id="tplCustomExpRow">
    <div class="cx-row" data-idx="">
      <div class="grid grid-4">
        <!-- 1) Label -->
        <div class="field">
          <label>Expense label</label>
          <input type="text" class="cx-label" placeholder="Utilities / Security / Admin…" />
        </div>

        <!-- 2) Year-1 (or plain) $/SF/yr -->
        <div class="field">
          <label>
            $/SF/yr
            <span class="kicker cx-kicker" hidden>(Year&nbsp;1)</span>
          </label>
          <div class="input-with-addon">
            <span class="addon">$</span>
            <input type="text" class="cx-val" inputmode="decimal" data-format="money" placeholder="0.50" />
            <span class="addon">/SF/yr</span>
          </div>
        </div>

        <!-- 3) Growth -->
        <div class="field">
          <label>Annual Increase</label>
          <div class="input-with-addon">
            <input type="text" class="cx-growth" inputmode="decimal" data-format="percent" placeholder="0.0" />
            <select class="cx-growthUnit select-filled">
              <option value="pct" selected>%/yr</option>
              <option value="flat">$ /SF/yr</option>
            </select>
          </div>
        </div>

        
        <!-- 4) Mode -->
        <div class="field">
          <label>Pass-through Mode</label>
          <select class="cx-mode select-filled">
            <option value="tenant" selected>Tenant pays 100%</option>
            <option value="landlord">Landlord pays 100%</option>
            <option value="stop">Base-year stop (increases only)</option>
          </select>
        </div>
      </div>

      <div class="field" style="display:none;" data-stop-type>
        <label>Stop Type</label>
        <select class="cx-stopType select-filled">
          <option value="base" selected>Base-year</option>
          <option value="fixed">Fixed stop</option>
        </select>
      </div>

      <div class="field cx-stopPSF-wrap" style="display:none;">
        <label>Fixed Stop ($/SF/yr)</label>
        <div class="input-with-addon">
          <span class="addon">$</span>
          <input type="text" class="cx-stopPSF" inputmode="decimal" placeholder="0.00" />
          <span class="addon">/SF/yr</span>
        </div>
      </div>

      <!-- Base-year value (only for stop) -->
      <div class="field cx-base-wrap" style="display:none;">
        <label>Base-year ($/SF/yr)</label>
        <div class="input-with-addon">
          <span class="addon">$</span>
          <input type="text" class="cx-base" inputmode="decimal" data-format="money" placeholder="leave blank to auto" />
          <span class="addon">/SF/yr</span>
        </div>
        <small class="hint">
          If blank, we’ll auto-fill from the Year-1 value at calculation time.
        </small>
      </div>

      <div class="row-actions">
        <button type="button" class="btn ghost small cx-delete">Remove</button>
      </div>
    </div>
  </template>
</section>

<!-- Section: Free rent & concessions -->
<div class="section-head col-span-4" id="sec-free">
  <h3 class="section-title">Free Rent & Abatements</h3>
  <p class="section-sub">Placement, timing, and custom pattern</p>
</div>

<!-- Free Rent (Months) -->
<div class="field col-1-2">
  <label for="freeMonths">Free Rent (Months)</label>
  <div class="free-rent-row">
    <input id="freeMonths" type="number" min="0" step="1" placeholder="3" />
    <select id="freePlacement" class="select-filled" aria-label="Free rent placement">
      <option value="inside" selected>Inside the Term</option>
      <option value="outside">Outside the Term</option>
    </select>
    <select id="freeTiming" class="select-filled" aria-label="When to apply free rent">
      <option value="begin" selected>Beginning of the Period</option>
      <option value="end">End of the Period</option>
    </select>
  </div>
</div>


<!-- Abatement Controls -->
<div class="field col-3">
<label>Abatement Type</label>
<div class="seg">
  <label><input type="radio" name="abateType" value="net" checked> Net</label>
  <label><input type="radio" name="abateType" value="gross"> Gross</label>
</div>
</div>


<!-- Custom pattern UI -->
<div class="field col-4">
<label>Custom Free Rent (Months) - Optional</label>
<input id="abateCustom" type="text" placeholder="1-3, 10, 25-27">
<small class="hint">Enter specific months or ranges for free rent abatement.</small>
<!-- optional: mini month grid could go here later -->
</div>

<!-- Section: Buildout -->
<div class="section-head col-span-4" id="sec-buildout">
  <h3 class="section-title">Buildout & Allowance</h3>
  <p class="section-sub">Allowance, treatment, and itemized budget</p>
</div>

<!-- Landlord Allowance -->
<div class="field col-1-2">
  <label for="llAllow">Landlord Allowance (TI)</label>
  <div class="input-with-addon">
    <span class="addon">$</span>
    <input id="llAllow" type="text" inputmode="decimal" placeholder="10.00" data-format="money" />
    <select id="llAllowUnit" class="select-filled" aria-label="Allowance unit">
      <option value="per_sf" selected>$/SF</option>
      <option value="total">$ Total</option>
    </select>
  </div>
</div>

<!-- Allowance Treatment + APR -->
<div class="field col-3-4">
  <label for="llAllowTreatment">Allowance Treatment</label>
  <div class="input-with-addon">
    <select id="llAllowTreatment" class="select-filled">
      <option value="cash" selected>Cash (upfront)</option>
      <option value="amort">Amortized</option>
    </select>
    <input id="llAllowApr" type="text" inputmode="decimal" placeholder="8.0"
           data-format="percent" style="margin-left:8px; display:none;" />
    <span class="addon">APR</span>
  </div>
  <small class="hint">Only the landlord-paid portion is treated as a rent concession.</small>
</div>

<!-- Itemize Buildout -->
<div class="field col-span-4">
  <details id="capexDetails">
    <summary class="capex-summary">
      <svg class="chev" width="12" height="12" viewBox="0 0 12 12" aria-hidden="true">
        <path d="M4 2l4 4-4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Buildout Budget — Itemize (optional)</span>
      <span id="capexChip" class="chip">0 items</span>
    </summary>

    <div id="capexEditor" class="capex-editor">
      <div class="capex-head">
        <span>Item</span>
        <span>Entry Type</span>
        <span>Amount</span>
        <span>$/SF</span>
        <span>Total</span>
        <span></span>
      </div>

      <!-- IMPORTANT: rows live inside #capexRows (JS relies on this) -->
      <div class="capex-rows" id="capexRows">
        <div class="capex-row">
          <input class="capex-item" type="text" placeholder="Office">
          <select class="capex-entry">
            <option value="psf" selected>$/SF</option>
            <option value="total">Total $</option>
          </select>
          <input class="capex-amount" inputmode="decimal" placeholder="0.00">
          <span class="capex-psf">—</span>
          <span class="capex-row-total">$0.00</span>
          <button type="button" class="capex-del" aria-label="Delete row">✕</button>
        </div>
      </div>

      <div class="capex-actions">
        <button type="button" id="capexAdd" class="btn small">Add row</button>
      </div>

      <!-- Totals (aligned with $/SF and Total columns) -->
      <div class="capex-totals">
        <div class="row">
          <span class="label">Total Improvement Costs</span>
          <span class="psf"   id="tiTotalCostsPSF">$0.00</span>
          <strong class="total" id="tiTotalCosts">$0.00</strong>
        </div>
      
        <div class="row">
          <span class="label">Less Landlord Allowance</span>
          <span class="psf"   id="tiLLTotalPSF">$0.00</span>
          <strong class="total" id="tiLLTotal">$0.00</strong>
        </div>
      
        <!-- NEW: a single, full-width rule that spans the grid -->
        <div class="capex-hr"></div>
      
        <div class="row" id="capexNetRow">
          <span class="label">Net Tenant Cost</span>
          <span class="psf"   id="tiNetTenantPSF">$0.00</span>
          <strong class="total" id="tiNetTenant">$0.00</strong>
        </div>
      </div>      
    </div>
  </details>
</div>

<script>
  // show/hide APR when treatment = amortized
  document.addEventListener('DOMContentLoaded', () => {
    const sel = document.getElementById('llAllowTreatment');
    const apr = document.getElementById('llAllowApr');
    if (!sel || !apr) return;
    const sync = () => { apr.style.display = (sel.value === 'amort') ? '' : 'none'; };
    sel.addEventListener('change', sync);
    sync();
  });
</script>


<!-- Section: Commissions & NPV -->
<div class="section-head col-span-4" id="sec-commnpv">
  <h3 class="section-title">Commissions & NPV</h3>
  <p class="section-sub">Broker commission and discount rate</p>
</div>

<!-- ===========================================================
     Commissions & NPV  (collapsible panel)
     =========================================================== -->
<!-- Commissions & NPV — styled like Buildout Budget -->
<div class="field col-span-4">
  <details id="commnpvDetails">
    <summary class="capex-summary">
      <svg class="chev" width="12" height="12" viewBox="0 0 12 12" aria-hidden="true">
        <path d="M4 2l4 4-4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Commissions &amp; NPV</span>
      <span id="commnpvChip" class="chip">—</span>
    </summary>

    <!-- Body uses same panel styling as Buildout -->
    <div class="capex-editor">
      <div class="commnpv-flex">
        <!-- Broker Commission (%) -->
        <div id="brokerCommField" class="field">
          <label for="brokerCommission">Broker Commission (%)</label>
          <div class="input-with-addon">
            <input id="brokerCommission" type="text" inputmode="decimal" placeholder="6.0" data-format="percent" />
            <span class="addon">%</span>
          </div>
        </div>

        <!-- Apply To -->
        <div class="field" id="brokerCommBasisField">
          <label for="brokerCommBasis">Apply To</label>
          <select id="brokerCommBasis" class="select-filled" aria-label="Commission basis">
            <option value="gross" selected>Gross</option>
            <option value="net">Net</option>
          </select>
        </div>

        <!-- Discount Rate (Optional) -->
        <div class="field" id="discountField">
          <label for="discount">Discount Rate (Optional)</label>
          <div class="input-with-addon">
            <input id="discount" type="text" inputmode="decimal" placeholder="8.0" data-format="percent" />
            <span class="addon">%</span>
          </div>
          <small class="hint">Used for PV-based NER. Monthly rate derived from annual.</small>
        </div>
      </div>
    </div>
  </details>
</div>

    

  <!-- Actions (spans all) -->
  <div class="actions col-span-4">
    <!-- AFTER -->
<button type="button" id="calcBtn" class="btn primary">Calculate</button>
    <button type="button" id="resetBtn" class="btn ghost">Reset</button>
    <button id="exportPdf" class="btn">Export PDF</button>
    <button id="exportExcel" class="btn">Export Excel</button>
  </div>
</form>

    <section class="panel panel-results" aria-live="polite">
      <h2 class="panel-title">Results</h2>
      
<!-- Results header: Landlord/Tenant + view toggle in one line -->
<div class="results-topbar">
  <div class="toggle-group" id="perspectiveToggles">
    <button type="button" class="toggle perspective-toggle active" data-perspective="landlord">Landlord</button>
    <button type="button" class="toggle perspective-toggle" data-perspective="tenant">Tenant</button>
  </div>

  <!-- One segmented control for all three views -->
<!-- View toggle -->
<div id="resultsViewToggle" class="view-pills">
  <button id="tabRentSchedule" class="btn-pill active" data-view="schedule">Rent Schedule</button>
  <button id="tabLeaseComparison" class="btn-pill" data-view="compare">Lease Comparison</button>
  <button id="tabCharts" class="btn-pill" data-view="charts">Charts</button>

</div>

    <div id="kpiResults" class="cards">
      <!-- Row 1 -->
      <div class="card">
        <div class="card-label">Lease Starts</div>
        <div class="card-value" id="leaseStart">&mdash;</div>
      </div>

      <div class="card">
        <div class="card-label">Lease Ends</div>
        <div class="card-value" id="leaseEnd">&mdash;</div>
        <div id="termChip" class="chips term-chip" aria-live="polite"></div>
      </div>

      <div class="card">
        <div class="card-label">Avg Monthly Net Rent</div>
        <div class="card-value" id="avgNetMonthly">$0.00</div>
        <div class="card-sub">Per month</div>
      </div>

      <div class="card">
        <div class="card-label">Avg Monthly Gross Rent</div>
        <div class="card-value" id="avgGrossMonthly">$0.00</div>
        <div class="card-sub">Per month</div>
      </div>

      <!-- Row 2 -->
      <div class="card">
        <div class="card-label">NER (PV)</div>
        <div class="card-value" id="nerPV">$0.00</div>
        <div class="card-sub">Per SF per year (PV-based)</div>
      </div>

      <div class="card">
        <div class="card-label">NER (non-PV)</div>
        <div class="card-value" id="nerSimple">$0.00</div>
        <div class="card-sub">Per SF per year (non-PV)</div>
      </div>

      <div class="card">
        <div class="card-label">Total Net Rent</div>
        <div class="card-value" id="totalNet">$0.00</div>
        <div class="card-sub">Across full schedule</div>
      </div>
      
      <div class="card">
        <div class="card-label">Total Gross Rent</div>
        <div class="card-value" id="totalGross">$0.00</div>
        <div class="card-sub">Across full schedule</div>
      </div>

      <!-- Value of Free Rent (PV) -->
      <div class="card" id="cardFreePV">
        <div class="card-title">Value of Free Rent (PV)</div>
        <div class="card-value" id="kpiFreePV">$0</div>
        <div class="card-sub" id="kpiFreeNominal">$0 nominal</div>
        <div class="chips"><span class="chip" id="kpiAbatedPct">—% of term abated</span></div>
      </div>

      <!-- Gross ↔ Net Spread -->
      <div class="card" id="cardSpread">
        <div class="card-title">Gross ↔ Net Spread (Avg/Month)</div>
        <div class="card-value" id="kpiSpread">$0</div>
        <div class="chips"><span class="chip" id="kpiRecovery">—% OpEx recovered</span></div>
      </div>

      <!-- LL Cash Outlay (PV) -->
      <div class="card" id="cardLLCashPV">
        <div class="card-title">LL Cash Outlay (PV)</div>
        <div class="card-value" id="kpiLLCashPV">$0</div>
        <div class="card-sub" id="kpiLLCashNote">TI + Commission (PV)</div>
      </div>

      <!-- All-in Occupancy Cost -->
      <div class="card" id="cardOccPSFmo">
        <div class="card-title">All-in Occupancy Cost</div>
        <div class="card-value" id="kpiOccPSFmo">$0/SF/mo</div>
        <div class="card-sub">Avg gross per SF per month</div>
      </div>

      <!-- Total Incentive Value (PV) -->
      <div class="card" id="cardIncentivePV">
        <div class="card-title">Total Incentive Value (PV)</div>
        <div class="card-value" id="kpiIncentivePV">$0</div>
        <div class="card-sub">Free Rent (PV) + TI (PV)</div>
      </div>

      <!-- Row 3 -->
      <div class="card" id="gciCard">
        <div class="card-label">Total Gross Commission (GCI)</div>
        <div class="card-value" id="gciTotal">$0.00</div>
      </div>
    </div>

<section id="compareSection" class="compare-section hidden">
  <div id="compareToggle"
       class="mt-4 flex w-full items-center gap-2"
       role="tablist" aria-label="Comparison view toggle">
    <button id="btnComparisonSummary"
            class="toggle-btn active"
            role="tab"
            aria-selected="true"
            aria-controls="comparisonSummary"
            type="button">
      Comparison Summary
    </button>
    <button id="btnCashFlowComparison"
            class="toggle-btn"
            role="tab"
            aria-selected="false"
            aria-controls="cashFlowComparison"
            type="button">
      Cash Flow Comparison
    </button>
  </div>

  <div id="compareControlsBar" class="compare-controls">
    <div class="count-ctrl compareCount">
      <label for="compareCount">Compare</label>
      <!-- Let JS populate 1..10 to avoid mismatched markup -->
      <select id="compareCount"></select>
    </div>
  </div>

  <section id="comparisonSummary" class="toggle-panel comparison-summary">
    <!-- Comparison Summary renders here -->
  </section>

  <section id="cashFlowComparison" class="toggle-panel hidden">
    <div class="compare-header">
      <!-- Give the title an id so we can set "Scenario Comparison (1—N)" -->
      <h3 id="scenarioCompareTitle" class="section-title">Cash Flow Comparison (1—3)</h3>

      <div id="hiddenRowsToggleHome" hidden>
        <label class="toggle hidden" id="hiddenRowsToggleWrap">
          <input type="checkbox" id="toggleHiddenRows" />
          <span>Show hidden rows</span>
        </label>
      </div>
    </div>

    <div id="compareGrid" class="compare-grid"></div>

    <!-- existing Cash Flow Comparison markup lives here -->

    <!-- Annual rent cash-flow compare (renders when ≥1 scenarios are pinned) -->
    <div id="cashflowCompare" class="cf-compare" style="margin-top:18px;"></div>
  </section>
</section>


  <!-- Charts grid wrapper (hidden in schedule view, shown in charts view) -->
  <!-- Chart canvases; populated by js/charts.js. -->
<section id="analysis-charts" class="charts-grid hidden">
    <!-- Cash Flow by Month -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>Cash Flow by Month</h3>
        <!-- Gross Line & Net Line Buttons -->
        <div id="chartsControls" class="inline-controls">
          <button type="button" onclick="charts.setCashTotalMode('gross')">Gross line</button>
          <button type="button" onclick="charts.setCashTotalMode('net')">Net line</button>
        </div>
      </div>
      <div class="chart-wrap"><canvas id="cfChart"></canvas></div>
    </div>

    <div class="chart-card">
    <h3>PV Waterfall (Tenant vs Landlord)</h3>
    <div class="chart-wrap"><canvas id="pvWaterfallChart"></canvas></div>
  </div>

  <div class="chart-card">
    <h3>Yearly PSF Trend</h3>
    <div class="chart-wrap"><canvas id="psfTrendChart"></canvas></div>
  </div>

  <div class="chart-card">
    <h3>Sensitivity (Î” NER)</h3>
    <div class="chart-wrap"><canvas id="tornadoChart"></canvas></div>
  </div>

  <div class="chart-card full">
    <h3>Abatement Timeline</h3>
    <div class="chart-wrap short"><canvas id="abatementChart"></canvas></div>
  </div>
</section>

<!-- ðŸ”½ Wrap both pieces in this one container -->
<div id="rent-schedule">
  <!-- Schedule-only toggles -->
  <div id="scheduleControls" class="schedule-controls">
    <div class="toggle-group">
      <button type="button" class="toggle active" data-view="annual">Annual</button>
      <button type="button" class="toggle" data-view="monthly">Monthly</button>
      <button type="button" class="toggle" data-view="monthly+subtotals">Monthly + Subtotals</button>
    </div>
  </div>

  <!-- Schedule table -->
  <div class="table-wrap">
    <table id="scheduleTable" class="schedule">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
    </section>
  </main>

  <footer class="site-footer">
    <span>&copy; <span id="year"></span> Lee &amp; Associates — Chicago</span>
  </footer>

<!-- Exports (load ExcelJS first, then our .xlsx exporter) -->
<script defer src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
<!-- Excel export via ExcelJS. -->
<script defer src="js/exports/export-excel.js"></script>
<!-- Print-to-PDF report builder (tables, KPIs, chart images). -->
<script defer src="js/exports/export-pdf.js?v=1"></script>

<!-- App (wires the Export button and everything else) -->
<!-- Core calculator and UI synchronization. -->
<script defer src="js/app.js?v=1"></script>

<!-- Chart.js library: used by js/charts.js. -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<!-- Chart wiring & theming helpers. -->
<script defer src="js/charts.js"></script>
<!-- Scenarios (Pin A/B/C) and compare grid. -->
<script defer src="js/scenarios.js"></script>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    // Make it global so app.js can call charts.update(...)
    window.charts = new NERCharts({ cashTotalMode: 'gross' });

    // If a model already exists (e.g., after hot reload), render it
    if (window.__ner_last && window.__ner_last.schedule?.length) {
      window.charts.update(window.__ner_last);
    }
  });
</script>
</body>
</html>


